<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Interview in Progress</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet"/>
  <style>
    body { font-family: 'Roboto', sans-serif; }
    .gradient-bg {
      background: linear-gradient(135deg, #1e1b4b, #0f172a, #1e293b);
    }
    .watermark {
      position: fixed;
      bottom: 10px;
      right: 10px;
      font-size: 14px;
      color: #ddd;
      opacity: 0.7;
      pointer-events: none;
    }
    .hidden { display: none; }
  </style>
</head>
<body class="gradient-bg text-white min-h-screen flex flex-col">

  <!-- Navbar -->
  <header class="flex justify-between items-center p-6 max-w-7xl mx-auto w-full">
    <h1 class="text-2xl font-bold">AI Interview App</h1>
    <nav class="space-x-6 hidden md:flex">
      <a href="index.html" class="hover:underline">Home</a>
      <a href="interviews.html" class="hover:underline">Interviews</a>
      <a href="about.html" class="hover:underline">About</a>
      <a href="contact.html" class="hover:underline">Contact</a>
    </nav>
    <a href="index.html" class="px-4 py-2 border border-white rounded-lg hover:bg-white hover:text-black transition">Exit</a>
  </header>

  <!-- Main Content -->
  <main class="flex-grow flex items-center justify-center px-4 py-6">
    <div class="bg-white text-black rounded-2xl shadow-lg p-6 md:p-10 max-w-3xl w-full text-center animate-fadeIn">
      <h2 id="categoryHeading" class="text-2xl font-bold mb-4"></h2>
      <div id="timer" class="text-3xl font-extrabold text-red-500 tracking-widest mb-4">3:00</div>
      <div id="current-question" class="text-xl font-semibold mb-6"></div>

      <video id="user-video" autoplay muted class="rounded-xl shadow-md w-full max-w-xl mx-auto bg-gray-200 h-64 md:h-80 mb-6"></video>

      <div class="flex justify-center gap-4">
        <button id="next-question"
          class="bg-green-500 hover:bg-green-400 text-white px-6 py-3 rounded-xl shadow-md font-semibold transition transform hover:scale-105">
          Next Question
        </button>
        <button id="end-interview"
          class="bg-red-500 hover:bg-red-400 text-white px-6 py-3 rounded-xl shadow-md font-semibold transition transform hover:scale-105">
          End Interview
        </button>
      </div>
    </div>
  </main>

  <!-- Footer -->
  <footer class="bg-gray-900 text-gray-400 text-center py-4">
    <p>&copy; 2025 AI Interview App. All rights reserved.</p>
  </footer>

  <!-- Watermark -->
  <div class="watermark">@Harshvardhan</div>

  <!-- Custom Alert Modal -->
  <div id="customAlert" class="hidden fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50">
    <div class="bg-white rounded-xl shadow-lg p-6 w-80 text-center animate-fadeIn">
      <h2 id="alertTitle" class="text-xl font-bold text-gray-800 mb-2">Alert</h2>
      <p id="alertMessage" class="text-gray-600 mb-4">Message goes here.</p>
      <button onclick="closeAlert()" 
              class="bg-blue-600 hover:bg-blue-500 text-white px-4 py-2 rounded-lg transition">
        OK
      </button>
    </div>
  </div>

  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const category = urlParams.get("category") || "Introduction";
    document.getElementById("categoryHeading").innerText = "Category: " + category;

    const questionSets = {
      "Software Development": ["What is polymorphism?", "Explain OOP.", "What is a REST API?"],
      "Data Science": ["What is overfitting?", "Explain supervised learning.", "What is a confusion matrix?"],
      "Sales Executive": ["Can you tell us a little about yourself?", "What do you know about our company?", "Why sales career?"],
      "Data Structures and Algorithms": ["What is an array?", "Explain dynamic programming.", "What is BFS vs DFS?"],
      "Object-Oriented Programming": ["What are 4 principles of OOP?", "What is encapsulation?", "What is polymorphism?"],
      "Machine Learning Basics": ["What is ML?", "Types of ML?", "What is supervised vs unsupervised learning?"],
      "Deep Learning": ["What is deep learning?", "What is a neural network?", "What is backpropagation?"],
      "Natural Language Processing": ["What is NLP?", "What is tokenization?", "What are word embeddings?"],
      "AI": ["What is AI?", "Types of AI?", "What is the Turing Test?"],
      "Introduction": ["Can you tell me a little about yourself?"],
      "Java": [
            "What is JVM, JRE, JDK?",
            "What is Runtime polymorphism and Compile-time polymorphism? Explain with example.",
            "What is abstraction in Java, how many types of it?",
            "What we should use to achieve 100% abstraction?",
            "What are OOPS concepts in Java? Which is the most important object-oriented principle in Java out of four?",
            "What is Immutable in Java? How to create Immutable class, step by step explanation.",
            "What is String Pool? Why Java uses String pool?",
            "When should we use ArrayList and when should we use LinkedList?",
            "What is common between HashSet and HashMap? Explain in detail.",
            "How to break Singleton Design Pattern?",
            "What is ConcurrentModificationException? Give example.",
            "What is Exception and Error? Give 3 examples of each.",
            "How to create Custom Exception? Explain step by step.",
            "What is Try With Resource, Try-Catch-Finally, Final, Finally, Finalize?",
            "What is Comparable and Comparator? Which one is better and why? Explain with example.",
            "What is the difference between ConcurrentHashMap, Synchronized HashMap, and HashMap? Why do we need them?",
            "What is equals() and hashCode()? What is hashCode collision?",
            "In which scenario should we override equals() and hashCode()?"
          ]

    };

    let questions = questionSets[category] || ["Default Question"];
    let currentIndex = 0;
    let remainingTime = 180;
    let timer;
    const timerElement = document.getElementById("timer");
    const questionElement = document.getElementById("current-question");
    const userVideo = document.getElementById("user-video");
    let mediaRecorder;
    let chunks = [];

    // Initialize camera and recording
    async function initVideo() {
      const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
      userVideo.srcObject = stream;
      mediaRecorder = new MediaRecorder(stream);
      mediaRecorder.ondataavailable = e => chunks.push(e.data);
      mediaRecorder.start();
    }

    function speak(text) {
      const utter = new SpeechSynthesisUtterance(text);
      speechSynthesis.speak(utter);
    }

    function showQuestion() {
      questionElement.innerText = questions[currentIndex];
      speak(questions[currentIndex]);
      remainingTime = 180;
      startTimer();
    }

    function startTimer() {
      clearInterval(timer);
      timer = setInterval(() => {
        if (remainingTime > 0) {
          remainingTime--;
          const min = Math.floor(remainingTime / 60);
          const sec = remainingTime % 60;
          timerElement.innerText = `${min}:${sec < 10 ? "0" : ""}${sec}`;
        } else {
          nextQuestion();
        }
      }, 1000);
    }

    function nextQuestion() {
      if (currentIndex < questions.length - 1) {
        currentIndex++;
        showQuestion();
      } else {
        questionElement.innerText = "Interview Completed. Thank you!";
        clearInterval(timer);
        showAlert("Interview Completed", "Thank you for participating! You may now end the session.");
      }
    }

    function endInterview() {
      clearInterval(timer);
      mediaRecorder.stop();
      mediaRecorder.onstop = () => {
        const blob = new Blob(chunks, { type: "video/webm" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "interview_recording.webm";
        a.click();
      };
      showAlert("Interview Ended", "Your recording has been saved. Redirecting to home...");
      setTimeout(() => {
        window.location.href = "index.html";
      }, 3000);
    }

    // Custom Alert functions
    function showAlert(title, message) {
      document.getElementById("alertTitle").innerText = title;
      document.getElementById("alertMessage").innerText = message;
      document.getElementById("customAlert").classList.remove("hidden");
    }

    function closeAlert() {
      document.getElementById("customAlert").classList.add("hidden");
    }

    document.getElementById("next-question").addEventListener("click", nextQuestion);
    document.getElementById("end-interview").addEventListener("click", endInterview);

    // Start camera and first question
    initVideo().then(() => {
      showQuestion();
    });
  </script>
</body>
</html>
